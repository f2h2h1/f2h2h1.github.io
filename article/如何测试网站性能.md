如何测试网站性能
================

## ab

一般的使用命令
- 模拟 10 个客户端，一共请求 1000 次，或者可以理解为模拟 10 个并发，一共请求 1000 次
```
./ab-c 10 -n 1000 http://www.baidu.com/
./ab --enable ssl -c 10 -n 1000 https://www.baidu.com/
./abs -c 10 -n 1000 https://www.baidu.com/
```
- ~~ab 测试工具不能直接支持 https 。要么加上 --enable ssl ，要么用 abs 工具， abs 和 ab 基本一致，只是支持 https 。新版的 ab 好像能直接用 https 协议~~

- 加上 -w 能输出 html
- -h 参数，能查看帮助

输出的解释
```
Server Software:        BWS/1.1 # 响应的服务器类型
Server Hostname:        www.baidu.com # 请求的 URL 主机名
Server Port:            443 # 请求端口
SSL/TLS Protocol:       TLSv1.2,ECDHE-RSA-AES128-GCM-SHA256,2048,128 # https 的版本和密码套件

Document Path:          / # 请求路径
Document Length:        227 bytes # HTTP响应数据的正文长度

Concurrency Level:      10 # 并发用户数，就是 -c 参数的值
Time taken for tests:   21.376 seconds  # 所有这些请求被处理完成所花费的总时间 单位秒
Complete requests:      1000 # 总请求数量，就是 -n 参数的值
Failed requests:        0 # 表示失败的请求数量
Total transferred:      1081951 bytes # 所有请求的响应数据长度总和。包括每个 HTTP 响应数据的头信息和正文数据的长度
HTML transferred:       227000 bytes # 所有请求的响应数据中正文数据的总和，也就是减去了 Total transferred 中 HTTP 响应数据中的头信息的长度
Requests per second:    46.78 [#/sec] (mean) # 吞吐量，计算公式: Complete requests/Time taken for tests  总请求数/处理完成这些请求数所花费的时间
Time per request:       213.762 [ms] (mean) # 用户平均请求等待时间，计算公式: Time token for tests/（Complete requests/Concurrency Level）。处理完成所有请求数所花费的时间/（总请求数/并发用户数）
Time per request:       21.376 [ms] (mean, across all concurrent requests) # 服务器平均请求等待时间，计算公式: Time taken for tests/Complete requests，正好是吞吐率的倒数。也可以这么统计: Time per request/Concurrency Level
Transfer rate:          49.43 [Kbytes/sec] received # 表示这些请求在单位时间内从服务器获取的数据长度，计算公式: Total trnasferred/ Time taken for tests，这个统计很好的说明服务器的处理能力达到极限时，其出口宽带的需求量。

Connection Times (ms)
              min  mean[+/-sd] median   max
Connect:       31  132 203.5     85    1204
Processing:     0   81 150.7     55    1141
Waiting:        0   53 122.5     35    1103
Total:         85  213 250.9    145    1304

Percentage of the requests served within a certain time (ms)
  50%    145 # 50% 的请求在 145ms 内返回
  66%    154
  75%    160
  80%    165
  90%    192
  95%   1133
  98%   1186 # 98% 的请求在 1186ms 内返回
  99%   1235
 100%   1304 (longest request)
```

## curl

一般的使用命令
```
curl -o /dev/null -s -w %{time_namelookup}::%{time_connect}::%{time_starttransfer}::%{time_total}::%{speed_download}"\n" "https://www.baidu.com"
```
- 这段命令只能在 git bash 或 linux 里运行

命令解释
```
-o: 把 curl 返回的 html js 写到 /dev/null
-s: 去掉所有状态
-w: 按照后面的格式输出
time_namelookup: DNS 解析域名 www.baidu.com 的时间
time_commect: client 和 server 端建立 TCP 连接的时间， 包括前一项的时间
time_starttransfer: 从 client 发出请求到 web 的 server 响应第一个字节的时间， 包括前二项的时间
time_total: client 发出请求到 web 的 server 发送会所有的相应数据的时间， 包括前三项的时间
speed_download: 下载速度 单位 byte/s
```
- 除了 speed_download 外，其它值越小越好
- time_total 最好小于 0.06

<!--
最好还是 300ms 以内
写一个脚本，测试多次，求平均值，连续10次的平均值就差不多了
输出每次的结果
输出平均值
大概命令像这样子
./testwebsite.sh 10 url

这样的脚本并不能测试并发
-->

## lighthouse

一个是浏览器自带的 lighthouse （基于 chromium 的浏览器才有）。
一个是谷歌在线的 lighthouse https://developers.google.com/speed/pagespeed/insights/ 。
- lighthouse 的分数计算器 https://googlechrome.github.io/lighthouse/scorecalc/
- 谷歌在线的 lighthouse 可能访问不了
- 要注意 设备的类型 (Device type) 是 桌面 (desktop) 还是 移动 (mobile)

评分一共有五部分
- 性能 (Performance)
- 访问无障碍 (Accessibility)
- 最佳实践 (Best Practice)
- 搜索引擎优化 (SEO)
- PWA (Progressive Web App)

一般情况下，只需要关注这三部分即可，分数越高越好
- Performance
- Best Practice
- SEO

一般情况下，如果低于这个分数就要优化
- Performance <= 70
- Best Practice <= 80
- SEO <= 80

## 浏览器开发者工具

## 其它

<!--
## 浏览器开发者工具里的 network `经过` 就是一个请求消耗的时间


各种 云供应商 提供的测试工具，一般都是要收费的


性能测试里，如果压力机性能不够的话，测试的结果参考价值会比较低。所以，如果在本地测试，最好把其它进程都关闭了，只保留测试工具的进程。


在谷歌判断网站是否有收录
site: domain.com

谷歌的网站测速，可以看到优化建议
https://developers.google.com/speed/pagespeed/insights
是否适合移动设备浏览
https://search.google.com/test/mobile-friendly
检查 html
https://validator.w3.org/nu/
检查 css
http://jigsaw.w3.org/css-validator/
检查 https
https://myssl.com/ssl.html
https://myssl.com/ats.html

Web 辅助功能评估工具
https://wave.webaim.org/

另一个网页评价工具
https://www.webpagetest.org/



查看 网站速度，查看 cdn 速度
http://tool.chinaz.com/speedworld/
http://cdn.chinaz.com/
http://tool.chinaz.com/sitespeed



http://report.chinaz.com/tool.chinaz.com


您的网站是否已被 Google 搜索引擎收录?
可在 Google 搜索引擎中对您的网站的首页网址执行“site:”搜索。
如果您能看到结果，则表明您的网站在索引中。如“site:wikipedia.org”。



site:www.my-domain.com/subdirectory/
只显示/subdirectory/目录下的页面
site:www.my-domain.com 词语
只显示页面中包含这个词语的关键词
site:www.my-domain.com inurl:词语
只显示URL中包含这个短语的
site:www.my-domain.com intitel:词语
只显示标题中包含这个短语的
site:www.my-domain.com filetype:pdf
只显示被收录的pdf文件


查找问题
curl -i -v -L 127.0.0.1:3001
ping www.qyresearch.com.cn
nslookup www.qyresearch.com.cn


2h4g2m 就够用了



在互联网上对于用户响应时间，有一个普遍的标准。2/5/10秒原则。

也就是说，在2秒之内给客户响应被用户认为是“非常有吸引力”的用户体验。在5秒之内响应客户被认为“比较不错”的用户体验，在10秒内给用户响应被认为“糟糕”的用户体验。如果超过10秒还没有得到响应，那么大多用户会认为这次请求是失败的。

-->
